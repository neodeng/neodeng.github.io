<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Phyneo's blog"><title>用scapy进行端口扫描 | Phyneo</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">用scapy进行端口扫描</h1><a id="logo" href="/.">Phyneo</a><p class="description">时间的尽头在哪里</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/projects/"><i class="icon-terminal"> 项目</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/photos/"><i class="icon-instagram"> 照片</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">用scapy进行端口扫描</h1><div class="post-meta">2016-03-27 | </div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Scapy_u7684_u5B89_u88C5"><span class="toc-number">1.</span> <span class="toc-text">Scapy的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4E0B_u8F7D_u5B89_u88C5scapy"><span class="toc-number">1.1.</span> <span class="toc-text">下载安装scapy</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#scapy"><span class="toc-number">1.1.1.</span> <span class="toc-text">scapy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#libdnet"><span class="toc-number">1.1.2.</span> <span class="toc-text">libdnet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pcap"><span class="toc-number">1.1.3.</span> <span class="toc-text">pcap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gnuplot-py"><span class="toc-number">1.1.4.</span> <span class="toc-text">gnuplot-py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pycrypto"><span class="toc-number">1.1.5.</span> <span class="toc-text">pycrypto</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PyX"><span class="toc-number">1.1.6.</span> <span class="toc-text">PyX</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5E38_u7528_u7AEF_u53E3_u626B_u63CF_u6280_u672F"><span class="toc-number">2.</span> <span class="toc-text">常用端口扫描技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#scpay_u7B80_u5355_u7528_u6CD5"><span class="toc-number">3.</span> <span class="toc-text">scpay简单用法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SYN_Scans"><span class="toc-number">3.1.</span> <span class="toc-text">SYN Scans</span></a></li></ol></li></ol></div></div><div class="post-content"><p>端口扫描是网络中常用的一种技术，我们可以通过Wireshark、sniffer、nmap等工具进行网络地址和端口探测，而Scapy则是Python编写的一种可以用来发送、嗅探、解析以及伪造网络数据包的工具。</p>
<h2 id="Scapy_u7684_u5B89_u88C5"><a href="#Scapy_u7684_u5B89_u88C5" class="headerlink" title="Scapy的安装"></a>Scapy的安装</h2><p>环境: Darwin<br>版本: 2.3.1  </p>
<h3 id="u4E0B_u8F7D_u5B89_u88C5scapy"><a href="#u4E0B_u8F7D_u5B89_u88C5scapy" class="headerlink" title="下载安装scapy"></a>下载安装scapy</h3><h4 id="scapy"><a href="#scapy" class="headerlink" title="scapy"></a>scapy</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget scapy.net  </span><br><span class="line">unzip scapy-latest.zip  </span><br><span class="line">cd scapy-<span class="number">2.3</span><span class="number">.1</span>  </span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>  
<p>然而仅安装scapy是不够的，还需要安装一些附加库文件:  </p>
<h4 id="libdnet"><a href="#libdnet" class="headerlink" title="libdnet"></a>libdnet</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd libdnet-<span class="number">1.12</span></span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">cd python</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<h4 id="pcap"><a href="#pcap" class="headerlink" title="pcap"></a>pcap</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd pylibpcap-xx</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<h4 id="gnuplot-py"><a href="#gnuplot-py" class="headerlink" title="gnuplot-py"></a>gnuplot-py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd gnuplot-py-<span class="number">1.8</span></span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<h4 id="pycrypto"><a href="#pycrypto" class="headerlink" title="pycrypto"></a>pycrypto</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd pycrypto-<span class="number">2.6</span><span class="number">.1</span></span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>
<h4 id="PyX"><a href="#PyX" class="headerlink" title="PyX"></a>PyX</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd PyX-<span class="number">0.12</span><span class="number">.1</span></span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>  
<h2 id="u5E38_u7528_u7AEF_u53E3_u626B_u63CF_u6280_u672F"><a href="#u5E38_u7528_u7AEF_u53E3_u626B_u63CF_u6280_u672F" class="headerlink" title="常用端口扫描技术"></a>常用端口扫描技术</h2><p>这里我们引用一篇非常好的文章<a href="http://resources.infosecinstitute.com/port-scanning-using-scapy/" target="_blank" rel="external">Port Scanning using Scapy</a>，同时可以参考该<a href="https://nmap.org/man/zh/man-port-scanning-techniques.html" target="_blank" rel="external">文章</a><br><strong>TCP connect scan:</strong> 该扫描方法通过建立TCP三次握手建立连接来扫描端口是否打开<br><strong>TCP stealth scan(SYN scan):</strong> 该方法与TCP connect scan类似，但是由于不是建立完整的连接，所以执行更快且不易被探测到<br><strong>XMAS/TCP NULL/FIN scan:</strong> 这三种方法行为上完全一致，其优点是可能比TCP SYN方法更隐蔽，缺点是主要适用于unix系统，且不能辨别一些开放的端口和被过滤的端口<br><strong>TCP ACK scan:</strong> 该方法并不用来探测端口的开闭，而是探测防火墙到状态和规则，确定哪些端口是被过滤的<br><strong>UDP scan:</strong>   </p>
<h2 id="scpay_u7B80_u5355_u7528_u6CD5"><a href="#scpay_u7B80_u5355_u7528_u6CD5" class="headerlink" title="scpay简单用法"></a>scpay简单用法</h2><p>scapy常用函数:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">arpcachepoison      : Poison target's cache with (your MAC,victim's IP) couple</span><br><span class="line">arping              : Send ARP who-has requests to determine which hosts are up</span><br><span class="line">bind_layers         : Bind 2 layers on some specific fields' values</span><br><span class="line">bridge_and_sniff    : Forward traffic between two interfaces and sniff packets exchanged</span><br><span class="line">corrupt_bits        : Flip a given percentage or number of bits from a string</span><br><span class="line">corrupt_bytes       : Corrupt a given percentage or number of bytes from a string</span><br><span class="line">defrag              : defrag(plist) -&gt; ([not fragmented], [defragmented],</span><br><span class="line">defragment          : defrag(plist) -&gt; plist defragmented as much as possible</span><br><span class="line">dyndns_add          : Send a DNS add message to a nameserver for "name" to have a new "rdata"</span><br><span class="line">dyndns_del          : Send a DNS delete message to a nameserver for "name"</span><br><span class="line">etherleak           : Exploit Etherleak flaw</span><br><span class="line">fragment            : Fragment a big IP datagram</span><br><span class="line">fuzz                : Transform a layer into a fuzzy layer by replacing some default values by random objects</span><br><span class="line">getmacbyip          : Return MAC address corresponding to a given IP address</span><br><span class="line">hexdiff             : Show differences between 2 binary strings</span><br><span class="line">hexdump             : --</span><br><span class="line">hexedit             : --</span><br><span class="line">is_promisc          : Try to guess if target is in Promisc mode. The target is provided by its ip.</span><br><span class="line">linehexdump         : --</span><br><span class="line">ls                  : List  available layers, or infos on a given layer</span><br><span class="line">promiscping         : Send ARP who-has requests to determine which hosts are in promiscuous mode</span><br><span class="line">rdpcap              : Read a pcap file and return a packet list</span><br><span class="line">send                : Send packets at layer 3</span><br><span class="line">sendp               : Send packets at layer 2</span><br><span class="line">sendpfast           : Send packets at layer 2 using tcpreplay for performance</span><br><span class="line">sniff               : Sniff packets</span><br><span class="line">split_layers        : Split 2 layers previously bound</span><br><span class="line">sr                  : Send and receive packets at layer 3</span><br><span class="line">sr1                 : Send packets at layer 3 and return only the first answer</span><br><span class="line">srbt                : send and receive using a bluetooth socket</span><br><span class="line">srbt1               : send and receive 1 packet using a bluetooth socket</span><br><span class="line">srflood             : Flood and receive packets at layer 3</span><br><span class="line">srloop              : Send a packet at layer 3 in loop and print the answer each time</span><br><span class="line">srp                 : Send and receive packets at layer 2</span><br><span class="line">srp1                : Send and receive packets at layer 2 and return only the first answer</span><br><span class="line">srpflood            : Flood and receive packets at layer 2</span><br><span class="line">srploop             : Send a packet at layer 2 in loop and print the answer each time</span><br><span class="line">traceroute          : Instant TCP traceroute</span><br><span class="line">tshark              : Sniff packets and print them calling pkt.show(), a bit like text 	wireshark</span><br><span class="line">wireshark           : Run wireshark on a list of packets</span><br><span class="line">wrpcap              : Write a list of packets to a pcap file</span><br></pre></td></tr></table></figure></p>
<h3 id="SYN_Scans"><a href="#SYN_Scans" class="headerlink" title="SYN Scans"></a>SYN Scans</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sr1(IP(dst=<span class="string">"xxx.xxx.xxx.xxx"</span>)/TCP(dport=<span class="number">80</span>,flags=<span class="string">"S"</span>))</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/TCP-IP/">TCP/IP</a></div><div class="post-nav"><a href="/2016/05/11/数据挖掘/" class="pre"><i class="icon-previous"></i></a><a href="/2016/03/23/关于正则表达式的POSIX规范/" class="next">关于正则表达式的POSIX规范<i class="icon-next"></i></a></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="si" value="http://yoursite.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/opencv/">opencv</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/TCP-IP/" style="font-size: 15px;">TCP/IP</a> <a href="/tags/机器学习-ESL学习笔记/" style="font-size: 15px;">机器学习 ESL学习笔记</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/vasp/" style="font-size: 15px;">vasp</a> <a href="/tags/opencv/" style="font-size: 15px;">opencv</a> <a href="/tags/图像处理/" style="font-size: 15px;">图像处理</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/07/07/机器学习模型之线性回归/">机器学习模型之线性回归</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/11/数据挖掘/">数据挖掘</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/27/用Scapy进行端口扫描/">用scapy进行端口扫描</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/23/关于正则表达式的POSIX规范/">关于正则表达式的POSIX规范</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/03/22/RaspberryPi中调用摄像头实时探测/">RaspberryPi中调用摄像头实时探测</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/25/vasp的安装与配置/">vasp的安装与配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/11/OpenCV图像降噪算法/">OpenCV图像降噪算法</a></li></ul></div><div class="widget"><div class="widget-title">联系方式</div><ul></ul><i class="icon-sina-weibo"> </i><a href="http://weibo.com/void520" title="微博" target="_blank">微博</a><ul></ul><i class="icon-github"> </i><a href="https://github.com/neodeng" title="Github" target="_blank">Github</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">Phyneo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"></div></body></html>